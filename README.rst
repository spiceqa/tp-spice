===================================
Spice test provider for avocado-vt_
===================================

- Source code repository: https://github.com/spiceqa/tp-spice
- Latest documentations: http://tp-spice.readthedocs.org

.. _avocado-vt: https://github.com/avocado-framework/avocado-vt

================
Travis-ci status
================

.. image:: https://travis-ci.org/spiceqa/tp-spice.svg?branch=master
    :target: https://travis-ci.org/spiceqa/tp-spice

===========
Howto start
===========

Before start, update **run.cfg** file and add something like this to the end:

    only RHEL.7.1.x86_64..role-guest, RHEL.6.7.i386..role-client

This is done automatically for Beaker task **spice-qe-tests**

************
General info
************

This tests depends on another test provider: tp-qemu

This is tests provider from SPICE QE

http://virt-test.readthedocs.org/en/latest/basic/TestProviders.html

Test files can be at any directory. Avocado-VT will be able to find it.

**********
virtio-win
**********

Windows should be provided with virtio-drivers to use: virtio_blk, virtio_scsi,
virtio_net. You can find virtio-win package at brewweb.

    # rpm -qf /usr/share/virtio-win/virtio-win-1.7.4.iso
      virtio-win-1.7.4-1.el6_6.noarch

Vista drivers for Unattended install
http://www.scribd.com/doc/17471845/FireGeier-Unattended-Vista-Guide-2#scribd

::

  # Windows
  drvload vioscsi.inf
  drvload viostor.inf
  drvload BALLOON.INF
  drvload NETKVM.INF
  drvload VIORNG.INF
  drvload VIOSER.INF
  pnputil -i -a .inf

  # dism /image:d:\ /add-driver
  /driver:e:\virtio\amd64\win2008\viostor.inf

  # NETCFG -WINPE to install the WinPE network stack


==========
Code notes
==========

::

 print "1:" + str(params.get("os_variant"))
 print "2:" + str(guest_vm.params.get("os_variant"))

Result is different:

::

 1:None
 2:rhel7

=====
Style
=====

- We use NumPy_ style docstrings.
- PEP8_ – Style Guide for Python Code.
- Google_ Python Style Guide.
- PEP257_ – Docstring Conventions
- Documentation is generated by Sphinx with autodoc_ and napoleon_ extensions.

.. _autodoc: http://www.sphinx-doc.org/en/stable/ext/autodoc.html
.. _napoleon: http://sphinxcontrib-napoleon.readthedocs.org/en/latest/index.html
.. _NumPy: http://sphinxcontrib-napoleon.readthedocs.org/en/latest/example_numpy.html
.. _PEP8: https://www.python.org/dev/peps/pep-0008
.. _Google: https://google.github.io/styleguide/pyguide.html
.. _PEP257: https://www.python.org/dev/peps/pep-0257


=====
HINTS
=====

    # avocado vt-bootstrap
    # avocado run --show-job-log io-github-autotest-qemu.boot --vt-extra-params 'image_name=images/rhel67-32_client' 'kill_vm_timeout = 30000'


===============
SSL Information
===============

Certificates are generated at VM start. Place is::

 virttest/qemu_vm.py
 if optget("spice_ssl") == "yes":
 utils_misc.create_x509_dir(prefix, c_subj, s_subj, passwd,  
                                               secure)

To check subject of cert::

 openssl x509 -in /tmp/spice_x509d/server-cert.pem -noout -text | grep Subject
         Subject: C=CZ, L=BRNO, O=SPICE, CN=10.34.72.94


============
Client tests
============

Directory **client-tests** contains tests for RV user interface. This tests are
copied to client VM and are run inside client VM.

- http://git.app.eng.bos.redhat.com/git/desktopqe/install.git?h=rhel-7
- https://vhumpa.fedorapeople.org/dogtail/epydoc/
- https://people.gnome.org/~parente/pyatspi/doc/
- http://git.app.eng.bos.redhat.com/git/desktopqe/
- vhumpa@: sticking latest el7 packages here:
  https://gitlab.com/dogtail/dogtail/tree/rpms/rpm


=======
Configs
=======

http://avocado-vt.readthedocs.io/en/latest/CartesianConfig.html

::

               tests-shared-spice.cfg           tests-shared-qemu.cfg
  base.cfg       +      X<-------------+top.cfg+----------->X    +    base.cfg
  machines.cfg+-------->X                                   X<-------+machines.cfg
  subtests.cfg   |      X<------+assignments-w-sfx.cfg+---->X    |    guest-os.cfg
  guest-os.cfg   | suffix / join                                 |    guest-hw.cfg
  guest-hw.cfg   |      X<------+tests-variants.cfg              |
  cdkeys.cfg     |                      X<------+spice-base.cfg  |
  virtio-win.cfg |                                               |
                 |                                               |
                 |                      tests.cfg+----->Result   |
                 |             run.cfg+---->X                    |
                 +------------------------->X<-------------------+


..
    vim: fileencoding=utf-8 filetype=rst :
    vim:set tw=72:
